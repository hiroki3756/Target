<% if flash[:notice] %>
    <div class="flash">
        <%= flash[:notice] %>
    </div>
<% end %>


<div class="container">
    <div class="">
        <h1>ユーザー詳細</h1>
    </div>
    <div class="">
        <%= attachment_image_tag @user, :profile_image, :fill, 60, 60, fallback: "no_image.png", size:'150x150', class: "user-show-img" %>
    </div>
    <div class="">
        <table class="table table-border">
            <tr>
                <th>名前</th>    
                <td><%= @user.name %></td>
            </tr>
            <tr>
                <th>自己紹介</th>
                <td><%= @user.introduction %></td>
            </tr>

            <tr>
                <th>フォロー数</th>
                <td><%= link_to following_user_user_path(@user) do %>
                    <%= @user.followings.count %>
                <% end %></td>
            </tr>
            <tr>
            <th>フォロワー数</th>
                <td><%= link_to followers_user_user_path(@user) do %>
                    <%= @user.followers.count %>
                <% end %></td>
            </tr>
        <% unless current_user == @user %>
        <% if current_user.following?(@user) %>
            <%= form_for(current_user.relationships.find_by(follow_id: @user.id), html: { method: :delete }) do |f| %>
            <%= hidden_field_tag :follow_id, @user.id %>
            <tr>
                <td><%= f.submit 'フォローを外す', class: "btn btn-danger" %></td>
            </tr>
            <% end %>
        <% else %>
            <%= form_for(current_user.relationships.build) do |f| %>
            <%= hidden_field_tag :follow_id, @user.id %>
            <tr>
                <td><%= f.submit 'フォローする', class: "btn btn-success" %></td>
            </tr>
            <% end %>
        <% end %>
        <% end %>
        </div>
        <tr>
            <% if @user == current_user %>
                <td><%= link_to "編集する", edit_user_user_path,class:"btn btn-success" %></td>
            <% end %>
        </tr>
        </table>
    </div>
   
    <div class="mb-4 mt-3">
        <h4 class="index"><%= @user.name %>さんの目標一覧</h4>
    </div>
    <div class="sort">
        <tr>
            <th>並び替え</th>
            <th><%= sort_link(@q, :title, "タイトル") %></th>
            <th><%= sort_link(@q, :achievement, "達成度") %></th>
            <th colspan="3"></th>
        </tr>
    </div>
    <% @objectives.each do |objective| %>
    <div class="target">
        <div class="mb-4">
            <h4>目標</h4>
        </div>
        <div class="mb-4">
            ・<%= objective.title %>
        </div>
        <div class="mb-4">
            <h4>意気込み</h4>
        </div>
        <div class="mb-4">
            ・<%= objective.explain %>
        </div>
        <div class="mb-4">
            <h3>達成度</h3>
        </div>
        <div class="mb-4">
            ・<%= objective.achievement %>%
        </div>
        <div class="mb-4">
            <h3>カテゴリー</h3>
        </div>
        <div class="mb-4">
            <% objective.tag_list.each do |tag| %>
            ・<%= link_to tag, user_user_path(tag_name: tag) %>
            <% end %>
        </div>
            <%= link_to "詳細", user_objective_path(objective),class: "btn btn-success" %>
    </div>
    <% end %>
</div>